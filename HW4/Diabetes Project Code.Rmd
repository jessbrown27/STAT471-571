---
title: "Predicting readmission probability for diabetes inpatients"
author: 
- Annie Vo
- Sarah Hayward
- Jessica Brown
date: ' '
output:
  html_document:
    code_folding: show
    highlight: haddock
    theme: lumen
    toc: yes
    toc_depth: 4
    toc_float: yes
  pdf_document:
    toc: yes
    toc_depth: '4'
  word_document:
    toc: yes
    toc_depth: '4'
urlcolor: blue
---

* to hide source code: echo = FALSE
* to hide text output: results = 'hide' or results = FALSE
* hide messages: message = FALSE
* hide warning messages: warning = FALSE
* hide plotsL fig.show = 'hide'

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, fig.width = 7, fig.height = 4)
if(!require("pacman")) install.packages("pacman")
pacman::p_load(dplyr, ggplot2, glmnet, car, data.table)   #add your packages here
```

# Executive Summary 

# Data Summary / EDA
* Nature of the data, origin
* Necessary quantitative and graphical summaries
* Are there any problems with the data?
* Which variables are considered as input 

```{r, echo=FALSE, results=FALSE}
diab <- read.csv("diabetic.data.csv")
head(diab)
summary(diab)
names(diab)
```

```{r, echo=FALSE, results=FALSE}
diabetes <- read.csv("diabetic.data.csv")
head(diabetes)
summary(diabetes)
names(diabetes)
```


```{r}
readmission <- read.csv("readmission.csv")
head(readmission)
summary(readmission)
names(readmission)
```

Let's look at what other variables should be factors
```{r}
readmission$race <- as.factor(readmission$race)
summary(readmission$race)
```
Here we note that 2273 patients have an unidentified race

```{r}
readmission$gender <- as.factor(readmission$gender)
summary(readmission$gender)
```


List of the variables we want to use as input: race, gender, time_in_hospital,

The original data is from the [Center for Clinical and Translational Research](https://archive.ics.uci.edu/ml/datasets/Diabetes+130-US+hospitals+for+years+1999-2008) at Virginia Commonwealth University. It covers data on diabetes patients across 130 U.S. hospitals from 1999 to 2008. There are over 100,000 unique hospital admissions in this dataset, from ~70,000 unique patients. The data includes demographic elements, such as age, gender, and race, as well as clinical attributes such as tests conducted, emergency/inpatient visits, etc.

For our analysis we will use a cleaned subset of this dataset which excludes variables with lots of missing values and variables with very little variability, as well as applying binning on some categorical variables. 

**TODO:** The event of interest is **readmitted within < 30 days**. Note that you need to create this response first by regrouping **Readmission indicator**!

```{r}
#create response variable for readmit within <30 days
readmission$readmit_ind <- ifelse(readmission$readmitted == "<30", 1, 0)
sum(readmission$readmit_ind)
```

```{r}
ggplot(readmission, aes(x = factor(gender), fill = gender)) +
  geom_bar(stat = "count", width = 0.7, color = "black") + 
  scale_fill_brewer(palette="Greens") + 
  xlab("gender") +
  ggtitle("Distribution of Gender in Cleaned Dataset") + 
  theme_minimal()
```

```{r}
ggplot(readmission, aes(x = factor(readmit_ind), fill = gender)) +
  geom_bar(stat = "count", width = 0.7, position = position_dodge(), color = "black") + 
  scale_fill_brewer(palette="Greens") + 
  xlab("Readmitted Within <30 Days") +
  ggtitle("Distribution of Gender with Response Variable") +
  theme_minimal()
```

```{r}
ggplot(readmission, aes(x = factor(race), fill = race)) +
  geom_bar(stat = "count", width = 0.7, color = "black") + 
  scale_fill_brewer(palette="Reds") + 
  xlab("race") +
  ggtitle("Distribution of Race in Cleaned Dataset") + 
  theme_minimal()
```

```{r}
ggplot(readmission, aes(x = factor(readmit_ind), fill = race)) +
  geom_bar(stat = "count", width = 0.7, color = "black") + 
  scale_fill_brewer(palette="Reds") + 
  xlab("Readmitted Within <30 Days") +
  ggtitle("Distribution of Race with Response Variable") +
  theme_minimal()
```

```{r}
ggplot(readmission, aes(x = factor(age_mod), fill = age_mod)) +
  geom_bar(stat = "count", width = 0.7, color = "black") + 
  scale_fill_brewer(palette="Blues") + 
  labs(title = "Distribution of Age in Cleaned Dataset", fill = "Age group", x = "Age group") + 
  theme_minimal()
```

```{r}
ggplot(readmission, aes(x = factor(age_mod), fill = gender)) +
  geom_bar(stat = "count", width = 0.7, color = "black", position = position_dodge()) + 
  scale_fill_brewer(palette="Greens") + 
  labs(title = "Distribution of Gender for Each Age Group", fill = "Gender", x = "Age group") + 
  theme_minimal()
```


# Analysis 
* Various appropriate statistical methods: e.g. glmnet 
* Comparisons various models
* Final model(s)

# Conclusion
* Summarize results and the final model
* Final recommendations

# Appendix
* Any thing necessary to keep but for which you donâ€™t want them to be in the main report
* Use Appendices to display lengthy output. 



