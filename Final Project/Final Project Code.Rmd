---
title: "Final Project"
output:
  pdf_document: default
  html_document: default
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, fig.width = 7, fig.height = 4)
if(!require("pacman")) install.packages("pacman")
pacman::p_load(dplyr, ggplot2, glmnet, car, data.table, GGally, leaps, gglasso, ggpubr, gridExtra, pROC, tidyverse, dplyr, skimr, factoextra, corrplot, tm, wordcloud)
```

#Executive Summary

Each row represents a movie available on FilmTV.it, with the original title, year, genre, duration, country, director, actors, average vote and votes.
The fie in the English version contains 37,711 movies and 19 attributes.

(we should add what each of the different variables mean)

# EDA
```{r}
film <- read.csv("filmtv_movies - ENG.csv")
```

```{r, echo=FALSE, results=FALSE}
summary(film)
```

## Data Cleaning
The first step in our data cleaning is to deal with missing values. First, there werre 88 movies that had no genre. So we used google to fill in the missing genres to ensure we could use those data points for our analysis. We also were able to find one movie that had no title, however, from the description we were able to determine the movie name as well as the genre. 
```{r, echo=FALSE, results=FALSE}
#there are 88 with no genre, I google to determine the genres of the movies
film[film$genre=="",]

film$genre[film$title == "Monsieur Batignole"] <- "Comedy"
film$genre[film$title == "Il posto dell'anima"] <- "Romantic"
film$genre[film$title == "Yossi & Jagger"] <- "Drama"
film$genre[film$title == "Cradle Will Rock"] <- "Drama"
film$genre[film$title == "Bord de mer"] <- "Drama"
film$genre[film$title == "Liberi"] <- "Action"
film$genre[film$title == "SubUrbia"] <- "Comedy"
film$genre[film$title == "It's a Very Merry Muppet Christmas Movie"] <- "Comedy"
film$genre[film$title == "L'autre"] <- "Comedy"
film$genre[film$title == "Nan va koutcheh/Zang-e tafrih/Dow rahehal baraye yek massaleh/Hamsarayan"] <- "Drama"
film$genre[film$title == "Une visite au Louvre"] <- "Documentary"
film$genre[film$title == "Wiesele"] <- "Drama"
film$genre[film$title == "König, Dame, Bube"] <- "Comedy"
film$genre[film$title == "Dokfa nai meuman"] <- "Documentary"
film$genre[film$title == "The Station Agent"] <- "Comedy"
film$genre[film$title == "Marija, krest'janskaja elegija"] <- "Drama"
film$genre[film$title == "Elegija Rossii"] <- "Drama"
film$genre[film$title == "Povinnost'"] <- "Documentary"
film$genre[film$title == "Smirennaja zizn'"] <- "Documentary"
film$genre[film$title == "Beautiful"] <- "Comedy"
film$genre[film$title == "The Muppets' Wizard of Oz"] <- "Comedy"
film$genre[film$title == "L'ingorgo - Una storia impossibile"] <- "Drama"
film$genre[film$title == "Pumhaeng zero"] <- "Romance"
film$genre[film$title == "Julian Po"] <- "Romance"
film$genre[film$title == "En la ciudad de Sylvia"] <- "Romance"
film$genre[film$title == "A vot' bon coeur"] <- "Comedy"
film$genre[film$title == "L'Immoralità"] <- "Thriller"
film$genre[film$title == "Cicciabomba"] <- "Comedy"
film$genre[film$title == "Homeless to Harvard: The Liz Murray Story"] <- "Drama"
film$genre[film$title == "Chaharshanbe-soori"] <- "Drama"
film$genre[film$title == "De la guerre"] <- "Comedy"
film$genre[film$title == "Elizabeth I"] <- "Drama"
film$genre[film$title == "35 rhums"] <- "Drama"
film$genre[film$title == "Ted Bundy"] <- "Crime"
film$genre[film$title == "Tatarak"] <- "Drama"
film$genre[film$title == "Ander"] <- "Romance"
film$genre[film$title == "Star Wars: Episode -1. As Clone pass by"] <- "Adventure"
film$genre[film$title == "La casa sperduta nel parco"] <- "Thriller"
film$genre[film$title == "Rivelazioni di uno psichiatra sul mondo perverso del sesso"] <- "Drama"
film$genre[film$title == "Kill Gil - Vol. 2"] <- "Documentary"
film$genre[film$title == "Plan B"] <- "Comedy"
film$genre[film$title == "Bancs publics (Versailles rive droite)"] <- "Comedy"
film$genre[film$title == "Get Low"] <- "Drama"
film$genre[film$title == "Love"] <- "Romance"
film$genre[film$title == "Kosmos"] <- "Comedy"
film$genre[film$title == "L'arroseur arrosé"] <- "Comedy"
film$genre[film$title == "La distrazione"] <- "Documentary"
film$genre[film$filmtv_id == 42646] <- "Documentary"
film$genre[film$title == "Zift"] <- "Thriller"
film$genre[film$title == "Vacanze col gangster"] <- "Comedy"
film$genre[film$filmtv_id == 43546] <- "Action"
film$genre[film$title == "Almanya - Willkommen in Deutschland"] <- "Comedy"
film$genre[film$title == "V Subbotu"] <- "Drama"
film$genre[film$title == "The Deal"] <- "Romance"
film$genre[film$title == "Fear City"] <- "Drama"
film$genre[film$title == "Gasu ningen dai ichigo"] <- "Fantasy"
film$genre[film$title == "Morte all'orecchio di Van Gogh"] <- "Documentary"
film$genre[film$title == "Fractions of Temporary Periods"] <- "Drama"
film$genre[film$title == "Questo film è dedicato a David Riesman e si intitolerà Capolavoro"] <- "Documentary"
film$genre[film$title == "Il ponte dei sospiri"] <- "Drama"
film$genre[film$title == "La gerla di papà Martin"] <- "Drama"
film$genre[film$title == "Walter Chiari - Fino all'ultima risata"] <- "Documentary"
film$genre[film$title == "Materiale resistente"] <- "Documentary"
film$genre[film$title == "Il prigioniero di Santa Cruz"] <- "Drama"
film$genre[film$title == "Kabe no naka no himegoto"] <- "Drama"
film$genre[film$title == "Amor Louco"] <- "Romance"
film$genre[film$title == "Una iena in cassaforte"] <- "Crime"
film$genre[film$title == "Amish Grace"] <- "Drama"
film$genre[film$title == "Il circolo Pickwick"] <- "Comedy"
film$genre[film$title == "Ties That Bind"] <- "Crime"
film$genre[film$title == "Oliveira, o arquitecto"] <- "Documentary"
film$genre[film$title == "The Adventures of Sherlock Holmes"] <- "Drama"
film$genre[film$title == "Jackass: The Lost Tapes"] <- "Action"
film$genre[film$title == "Sedia elettrica"] <- "Thriller"
film$genre[film$title == "Wrong Cops"] <- "Comedy"
film$genre[film$title == "Educação Sentimental"] <- "Romance"
film$genre[film$title == "Mia moglie, un corpo per l'amore"] <- "Drama"
film$genre[film$title == "Xi You"] <- "Adventure"
film$genre[film$title == "Kreditis Limiti"] <- "Drama"
film$genre[film$title == "Come quando fuori piove"] <- "Comedy"
film$genre[film$title == "Incontro"] <- "Romance"
film$genre[film$title == "Lo scialo"] <- "Romance"
film$genre[film$title == "Mon Mon Mon Monsters"] <- "Thriller"
film$genre[film$title == "The Farm"] <- "Horror"
film$genre[film$title == "All the Colors of Giallo"] <- "Horror"
film$genre[film$title == "Night School"] <- "Horror"
film$genre[film$title == "Tensión sexual, Volumen 1: Volátil"] <- "Drama"

film$title[film$filmtv_id == 47741] <- "Cry of a Prostitute"
film$genre[film$filmtv_id == 47741] <- "Crime"

```

Here we are making film into a factor as it contains categorical variables that would be better analyzed as factors.
```{r}
#make genre into a factor
film$genre <- as.factor(film$genre)
levels(film$genre)
```

We will also make the year variable into different subsections including different years that will be used as a factor. We are going to make the years in sections of 10 years from 1897 to 2021, that will give us 14 different levels of year modulos to work with
```{r}
film$year_mod <- NA
summary(film$year)
film$year_mod[film$year < 1900] <- "[1890,1900)"
film$year_mod[film$year > 1899 & film$year < 1910] <- "[1900,1910)"
film$year_mod[film$year > 1909 & film$year < 1920] <- "[1910,1920)"
film$year_mod[film$year > 1919 & film$year < 1930] <- "[1920,1930)"
film$year_mod[film$year > 1929 & film$year < 1940] <- "[1930,1940)"
film$year_mod[film$year > 1939 & film$year < 1950] <- "[1940,1950)"
film$year_mod[film$year > 1949 & film$year < 1960] <- "[1950,1960)"
film$year_mod[film$year > 1959 & film$year < 1970] <- "[1960,1970)"
film$year_mod[film$year > 1969 & film$year < 1980] <- "[1970,1980)"
film$year_mod[film$year > 1979 & film$year < 1990] <- "[1980,1990)"
film$year_mod[film$year > 1989 & film$year < 2000] <- "[1990,2000)"
film$year_mod[film$year > 1999 & film$year < 2010] <- "[2000,2010)"
film$year_mod[film$year > 2009 & film$year < 2020] <- "[2010,2020)"
film$year_mod[film$year > 2019 & film$year < 2030] <- "[2020,2030)"

film$year_mod <- as.factor(film$year_mod)
summary(film$year_mod)
```

```{r}
#here we want to make sure we save the data to a new csv since we have to submit the cleaned data as well as the old data
```


## Plots
```{r}
ggplot(film) + 
  geom_histogram(aes(x = avg_vote), bins = 10, fill = "light blue") +
  labs( title = "Histogram of Average Vote", x = "Average Vote" , y = "Frequency")
```

```{r}
ggplot(subset(film, duration < 300)) + 
  geom_histogram(aes(x = duration), bins = 10, fill = " blue") +
  labs( title = "Histogram of Movie Length (for those less than 300 minutes)", x = "Length of Movie (minutes)" , y = "Frequency")
```

```{r}
ggplot(film) + 
  geom_histogram(aes(x = year), bins = 10, fill = "light green") +
  labs( title = "Histogram of Movie Release Year", x = "Year" , y = "Frequency")
```

```{r}
ggplot(film) + 
  geom_histogram(aes(x = humor), bins = 5, fill = "red") +
  labs( title = "Histogram of Humor", x = "Humor" , y = "Frequency")
```
```{r}
ggplot(film) + 
  geom_histogram(aes(x = rhythm), bins = 5, fill = "pink") +
  labs( title = "Histogram of Rhythm", x = "Rhythm" , y = "Frequency")
```

```{r}
ggplot(film) + 
  geom_histogram(aes(x = effort), bins = 5, fill = "orange") +
  labs( title = "Histogram of Effort", x = "Effort" , y = "Frequency")
```

```{r}
ggplot(film) + 
  geom_histogram(aes(x = tension), bins = 5, fill = "purple") +
  labs( title = "Histogram of Tension", x = "Tension" , y = "Frequency")
```

```{r}
ggplot(film) + 
  geom_histogram(aes(x = erotism), bins = 5, fill = "maroon") +
  labs( title = "Histogram of Erotism", x = "Erotism" , y = "Frequency")
```

Let's look at the correlation between some of the numerical variables and average vote. 

```{r}
film %>%
  select(avg_vote, duration, critics_vote, public_vote) %>%
  ggpairs()
```

In our data we noticed that there are three different voting variables. Our ultimate goal is to predict the average vote, so we want to determine if the public vote and critics vote have a linear relationship or high correlation to the average vote. If that is the case, we will remove those variables from the regression as they have a somewhat linear dependency on one another. 
```{r}
plot(film$avg_vote, film$critics_vote)
abline(lm(avg_vote~critics_vote, film))
```
We can see that the scatter plot shows a high correlation between the average vote and the critics vote with a correlation of 0.915. Thus there is almost a linear relationship between the variables so we will remove critics vote for the sake of prediction and regression. 

```{r}
plot(film$avg_vote, film$public_vote)
abline(lm(avg_vote~public_vote, film))
```
We can see that this scatter plot also shows a high correlation between the average vote and the public vote with a correlation of 0.891. Thus there is almost a linear relationship between the variables so we will remove public vote for the sake of prediction and regression as well. 


# PCA
Let's create PCA scores for our data set and see if they tell us anything important. 


# Linear Regression

Let's try to predict the average vote using some of the other variables in the data set. First, we will drop some of the variables in the data set that are not useful for the regression, such as `filmtv_id`,`year`, `title`,`country`, `directors`, `actors`, `description`, and `notes`. We will also remove `critics_vote` and `public_vote` as indicated previously. 

```{r}
film2 <- film[,-c(1,2,3,6,7,8,10,11,13,14)]
#get rid of rating
```

## Simple Regression

I think we should add 1 of two simple regression models and slowly add variables to see what happens and we can write analysis of the models and they mean. 


##Multiple Regression
Let's run a linear model using all of the variables
```{r}
fit1 <- lm(avg_vote~.,film2)
Anova(fit1)
summary(fit1)
```
Based on the ANOVA for this test, we can see that all of the variables used the the regression are significant. 


# LASSO


# Trees



# Logistic Regression

Now let's use our data to perform a Logistic Regression to determine whether the movie is good or bad. We will use the average vote numbers to make a binary variable that is 1 if the rating is greater than 6, and 0 otherwise.
```{r}
film2$rating <- ifelse(film2$avg_vote > 6 , "1", "0")
film2$rating <- as.integer(film2$rating)
table(film2$rating)
#add a jitter plot
```

Now we want to split up our data in testing and training.

# Text Analysis 

## Description EDA
```{r, echo = FALSE, results = FALSE}
desc_text <- film$description
corpus <- VCorpus(VectorSource(desc_text))

# Converts all words to lowercase
corpus_clean <- tm_map(corpus, content_transformer(tolower))

# Removes common English stopwords (e.g. "with", "i")
corpus_clean <- tm_map(corpus_clean, removeWords, stopwords("english"))

corpus_clean <- tm_map(corpus_clean, removePunctuation)

# Removes numbers
corpus_clean <- tm_map(corpus_clean, removeNumbers)

# Stem words
corpus_clean <- tm_map(corpus_clean, stemDocument, lazy = TRUE)

dtm <- DocumentTermMatrix(corpus_clean)
dtms <- removeSparseTerms(dtm, 0.995)
```

```{r, echo = FALSE, fig.width = 3, fig.height = 3}
total_freq <- sort(colSums(as.matrix(dtms)), decreasing = TRUE)
cor.special <- brewer.pal(8, "Dark2")
wordcloud(names(total_freq)[1:100], total_freq[1:100], colors=cor.special, ordered.colors=F)
```


